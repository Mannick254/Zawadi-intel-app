<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Public Biographies — Zawadi Intel</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png" type="image/png" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="js/main.js"></script>
  <script src="js/decrypt.js"></script> <!-- 🔐 Secure decryption -->
</head>
<body>
  <header class="fade-in">
  <h1>📖 Public Biographies</h1>
  <p class="tagline">“Shared stories. Eternal echoes.”</p>
  <nav class="button-group slide-up">
    <a href="index.html" class="btn">🏠 Home</a>
    <a href="app.html" class="btn">🔐 Archive</a>
    <a href="biography.html" class="btn">📖 Biographies</a>
    <a href="media.html" class="btn">📺 Media</a>
    <a href="legacy.html" class="btn">🌱 Legacy</a>
    <button onclick="showRandomIntel()" class="btn">🎲 Surprise Me</button>
  </nav>
</header>
<div id="introOverlay">
  <h2>✨ Welcome to Zawadi Intel</h2>
  <p>Where every story becomes a legacy.</p>
</div>

<section class="video-spotlight slide-up">...</section>
<section class="write-legacy slide-up">...</section>
<section class="bio-card fade-in">...</section>
  <section>
    <div class="bio-controls" style="display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:1em;">
      <h2 style="margin-bottom:0;">Biographies</h2>
      <div style="display:flex;gap:0.5em;align-items:center;">
        <button class="btn" id="refreshBiosBtn" type="button">🔄 Refresh</button>
        <button class="btn" id="clearSearchBtn" type="button" style="display:none;">❌ Clear</button>
      </div>
    </div>
    <input type="text" id="bioSearchInput" placeholder="Search biographies..." style="margin:1em 0;width:100%;max-width:400px;" />
    <div id="bioLoading" style="display:none;text-align:center;margin:1em 0;">Loading biographies...</div>
    <div id="emptyStateMsg" style="display:none;text-align:center;color:#f44336;font-weight:bold;margin:2em 0;">No biographies found for your search.</div>
    <div id="jsonBiosSection">
      <h3>Featured Biographies (from JSON) <span id="jsonBiosCount" style="font-weight:normal;color:#00bcd4;"></span></h3>
      <div id="jsonBiosList" class="slide-up"></div>
    </div>
    <div id="userBiosSection">
      <h3>User Submitted Biographies <span id="userBiosCount" style="font-weight:normal;color:#00bcd4;"></span></h3>
      <div id="userBiosList" class="slide-up"></div>
    </div>
  </section>
<div id="legacyTip" class="fade-in">
  💡 Tip: You don’t need an account to write your legacy. Just start typing below.
</div>


  <!-- 🎥 YouTube Spotlight -->
  <section class="video-spotlight">
    <h2>🎥 Legacy Spotlight</h2>
    <iframe width="100%" height="315" src="https://www.youtube.com/embed/2O7K-8G2nwU"
      title="Faith Kipyegon Documentary" frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen></iframe>
  </section>

  <!-- 📝 Guest Legacy Writer -->
  <section class="write-legacy">
    <h2>📝 Write Your Legacy</h2>
    <textarea id="guestLegacy" placeholder="Write something about yourself..."></textarea>
    <button onclick="saveGuestLegacy()">💾 Save Locally</button>
    <div id="guestDisplay" class="legacy-output"></div>
  </section>

  <!-- 🔦 Featured Biography -->
  <section class="bio-card fade-in">
    <h2>Featured Biography</h2>
    <h3>Faith Chepngetich Kipyegon</h3>
    <p><strong>Born:</strong> January 10, 1994 – Nakuru County, Kenya</p>
    <p><strong>Nickname:</strong> The Smiling Destroyer</p>
    <p><strong>Specialty:</strong> 1500m, 5000m</p>
    <p><strong>Legacy Quote:</strong> <em>“I run with faith, not fear.”</em></p>

    <h4>🏆 Career Highlights</h4>
    <ul>
      <li>3× Olympic Gold (1500m): Rio 2016, Tokyo 2020, Paris 2024</li>
      <li>5× World Champion (1500m & 5000m)</li>
      <li>World Records: 1500m, Mile, 3000m</li>
    </ul>

    <h4>🌱 Early Life</h4>
    <p>Raised in Keringet, Nakuru County, Faith ran barefoot until age 15. Her breakout came in 2010 at the World Cross Country Championships.</p>

    <h4>👩‍👧 Personal Life</h4>
    <p>Married to Olympic bronze medalist Timothy Kitum. Mother to Alyn Chepkor Kiprono. Resides in Eldoret, Kenya.</p>

    <h4>🕊️ Legacy Impact</h4>
    <p>Faith is the only woman to win three consecutive Olympic golds in the 1500m. Her 2023 record-breaking streak earned her World Athlete of the Year.</p>
  </section>


    // Modernized integration: async/await, separate sections, refresh, search, loading
    async function loadJsonBiographies(filter = '') {
      const loading = document.getElementById('bioLoading');
      const list = document.getElementById('jsonBiosList');
      const countSpan = document.getElementById('jsonBiosCount');
      loading.style.display = 'block';
      list.innerHTML = '';
      let count = 0;
      try {
        const response = await fetch('data/biographies.json');
        const bios = await response.json();
        if (!Array.isArray(bios) || bios.length === 0) {
          list.innerHTML = '<em>No biographies found.</em>';
          countSpan.textContent = '(0)';
        } else {
          let filtered = bios;
          if (filter) {
            filtered = bios.filter(bio =>
              bio.name.toLowerCase().includes(filter) ||
              bio.bio.toLowerCase().includes(filter)
            );
          }
          count = filtered.length;
          countSpan.textContent = `(${count})`;
          if (filtered.length === 0) {
            list.innerHTML = '';
          } else {
            filtered.forEach(bio => {
              const div = document.createElement('div');
              div.className = 'intel-entry fade-in';
              div.innerHTML = `
                <h3>${bio.name}</h3>
                <p>${bio.bio}</p>
              `;
              list.appendChild(div);
            });
          }
        }
      } catch {
        list.innerHTML = '<em>Could not load biographies.</em>';
        countSpan.textContent = '';
      }
      loading.style.display = 'none';
      return count;
    }

    function decrypt(cipher) {
      try {
        return CryptoJS.AES.decrypt(cipher, "2025Zawadi").toString(CryptoJS.enc.Utf8);
      } catch {
        return "[Decryption Failed]";
      }
    }

    function loadUserBiographies(filter = '') {
      const list = document.getElementById('userBiosList');
      const countSpan = document.getElementById('userBiosCount');
      list.innerHTML = '';
      const publicEntries = JSON.parse(localStorage.getItem('zawadiIntel')) || {};
      let allPublic = [];
      Object.values(publicEntries).forEach(val => {
        if (Array.isArray(val)) {
          allPublic = allPublic.concat(val.filter(e => e.public));
        }
      });
      allPublic.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      let filtered = allPublic;
      if (filter) {
        filtered = allPublic.filter(entry =>
          decrypt(entry.title).toLowerCase().includes(filter) ||
          decrypt(entry.content).toLowerCase().includes(filter)
        );
      }
      countSpan.textContent = `(${filtered.length})`;
      if (filtered.length === 0) {
        list.innerHTML = '';
      } else {
        filtered.forEach(entry => {
          const div = document.createElement('div');
          div.className = 'intel-entry fade-in';
          div.innerHTML = `
            <h3>${decrypt(entry.title)}</h3>
            <p>${decrypt(entry.content)}</p>
            ${entry.quote ? `<blockquote class="quote">${decrypt(entry.quote)}</blockquote>` : ''}
            <small>By ${entry.author} — ${entry.timestamp}</small>
          `;
          list.appendChild(div);
        });
      }
      return filtered.length;
    }

    async function refreshBiographies() {
      const filter = document.getElementById('bioSearchInput').value.trim().toLowerCase();
      const jsonCount = await loadJsonBiographies(filter);
      const userCount = loadUserBiographies(filter);
      // Show empty state if both are zero
      const emptyMsg = document.getElementById('emptyStateMsg');
      if (jsonCount === 0 && userCount === 0) {
        emptyMsg.style.display = 'block';
      } else {
        emptyMsg.style.display = 'none';
      }
      // Show/hide clear search button
      const clearBtn = document.getElementById('clearSearchBtn');
      if (filter) {
        clearBtn.style.display = 'inline-block';
      } else {
        clearBtn.style.display = 'none';
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      refreshBiographies();
      const bioForm = document.getElementById('bioForm');
      if (bioForm) {
        bioForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const name = document.getElementById('bioName').value.trim();
          const content = document.getElementById('bioContent').value.trim();
          const quote = document.getElementById('bioQuote').value.trim();
          const msg = document.getElementById('bioFormMsg');
          if (!name || !content) {
            msg.textContent = 'Name and biography are required.';
            return;
          }
          const entry = {
            title: CryptoJS.AES.encrypt(name, "2025Zawadi").toString(),
            content: CryptoJS.AES.encrypt(content, "2025Zawadi").toString(),
            quote: quote ? CryptoJS.AES.encrypt(quote, "2025Zawadi").toString() : '',
            author: name,
            public: true,
            timestamp: new Date().toLocaleString()
          };
          const allIntel = JSON.parse(localStorage.getItem('zawadiIntel')) || {};
          if (!allIntel['public']) allIntel['public'] = [];
          allIntel['public'].push(entry);
          localStorage.setItem('zawadiIntel', JSON.stringify(allIntel));
          msg.textContent = '✅ Biography posted!';
          bioForm.reset();
          refreshBiographies();
        });
      }
      // Guest legacy
      const saved = localStorage.getItem('guestLegacy');
      if (saved) {
        document.getElementById('guestLegacy').value = saved;
        document.getElementById('guestDisplay').textContent = saved;
      }
      // Refresh button
      document.getElementById('refreshBiosBtn').onclick = refreshBiographies;
      // Search filter
      document.getElementById('bioSearchInput').addEventListener('input', refreshBiographies);
      // Clear search button
      document.getElementById('clearSearchBtn').onclick = function() {
        document.getElementById('bioSearchInput').value = '';
        refreshBiographies();
      };
    // Animation for fade-in
    const style = document.createElement('style');
    style.innerHTML = `
      .fade-in { animation: fadeInBio 0.7s; }
      @keyframes fadeInBio { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: none; } }
      @media (max-width: 600px) {
        .bio-controls { flex-direction: column; align-items: stretch; }
        #bioSearchInput { max-width: 100%; }
      }
    `;
    document.head.appendChild(style);
    });

    function showRandomIntel() {
      const publicEntries = JSON.parse(localStorage.getItem('zawadiIntel')) || {};
      const entries = Object.values(publicEntries).flat().filter(e => e.public);
      if (entries.length === 0) return;
      const entry = entries[Math.floor(Math.random() * entries.length)];
      alert(`"${decrypt(entry.title)}"\n\n${decrypt(entry.content)}\n\n— ${entry.author}`);
    }

    function saveGuestLegacy() {
      const text = document.getElementById('guestLegacy').value.trim();
      localStorage.setItem('guestLegacy', text);
      document.getElementById('guestDisplay').textContent = text;
    }
  </script>
      if (saved) {
        document.getElementById('guestLegacy').value = saved;
        document.getElementById('guestDisplay').textContent = saved;
      }
    });

    function showRandomIntel() {
      const publicEntries = JSON.parse(localStorage.getItem('zawadiIntel')) || {};
      const entries = Object.values(publicEntries).flat().filter(e => e.public);
      if (entries.length === 0) return;
      const entry = entries[Math.floor(Math.random() * entries.length)];
      alert(`"${decrypt(entry.title)}"\n\n${decrypt(entry.content)}\n\n— ${entry.author}`);
    }

    function saveGuestLegacy() {
      const text = document.getElementById('guestLegacy').value.trim();
      localStorage.setItem('guestLegacy', text);
      document.getElementById('guestDisplay').textContent = text;
    }
  </script>
</body>
</html>
